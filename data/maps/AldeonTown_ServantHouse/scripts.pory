const OBJ_EVENT_SERVANT = 1

mapscripts AldeonTown_ServantHouse_MapScripts {

	MAP_SCRIPT_ON_TRANSITION {
		//Show Orestes for Scene
		if (var(VAR_ORESTES_STATE) == 8) {
			call (AldeonTown_ServantHouse_Script_SetupOrestesScene)
		}
		//Update servant location
		if (var(VAR_ORESTES_STATE) > 8) {
			call (AldeonTown_ServantHouse_Script_ShowServantByStairs)
		}
	}

	MAP_SCRIPT_ON_LOAD {
		//Show stairs
		if (var(VAR_ORESTES_STATE) < 9) {
			call (AldeonTown_ServantHouse_Script_HideStairs)
		}
	}

	MAP_SCRIPT_ON_FRAME_TABLE [
		VAR_ORESTES_STATE, 8: AldeonTown_ServantHouse_Script_OrestesInServantHouse
	]

}

script AldeonTown_ServantHouse_Script_SetupOrestesScene {
	setobjectxyperm (LOCALID_ALDEONSERVANTHOUSE_SERVANT, 6, 5)
	setobjectxyperm (LOCALID_ALDEONSERVANTHOUSE_ORESTES, 5, 5,)
	setobjectmovementtype (LOCALID_ALDEONSERVANTHOUSE_ORESTES, MOVEMENT_TYPE_FACE_RIGHT)
	return
}

script AldeonTown_ServantHouse_Script_ShowServantByStairs {
	setobjectxyperm (LOCALID_ALDEONSERVANTHOUSE_SERVANT, 7, 2)
	setobjectmovementtype (LOCALID_ALDEONSERVANTHOUSE_SERVANT, MOVEMENT_TYPE_FACE_DOWN)
	return
}

script AldeonTown_ServantHouse_Script_ShowStairs {
	setmetatile (5, 0, METATILE_GenericBuilding_BlueWall_StairsTopLeft, TRUE)
	setmetatile (6, 0, METATILE_GenericBuilding_BlueWall_StairsTopCenter, TRUE)
	setmetatile (7, 0, METATILE_GenericBuilding_BlueWall_StairsTopRight, TRUE)
	setmetatile (5, 1, METATILE_GenericBuilding_BlueWall_StairsBottomLeft, TRUE)
	setmetatile (6, 1, METATILE_GenericBuilding_TrickHouse_Stairs_Down, FALSE)
	setmetatile (7, 1, METATILE_GenericBuilding_BlueWall_StairsBottomRight, TRUE)
    special (DrawWholeMapView)
	return
}

script AldeonTown_ServantHouse_Script_HideStairs {
	setmetatile (5, 0, METATILE_GenericBuilding_BlueWallTop, TRUE)
	setmetatile (6, 0, METATILE_GenericBuilding_BlueWallTop, TRUE)
	setmetatile (7, 0, METATILE_GenericBuilding_BlueWallTop, TRUE)
	setmetatile (5, 1, METATILE_GenericBuilding_BlueWallBottom, TRUE)
	setmetatile (6, 1, METATILE_GenericBuilding_BlueWallBottom, TRUE)
	setmetatile (7, 1, METATILE_GenericBuilding_BlueWallBottom, TRUE)
	return
}

script AldeonTown_ServantHouse_Script_OrestesInServantHouse {
	//alert player
	applymovement (LOCALID_PLAYER, Common_Movement_ExclamationMark)
	waitmovement (0)
	//player to position
	applymovement (LOCALID_PLAYER, Common_Movement_WalkUp)
	waitmovement (0)
	applymovement (LOCALID_PLAYER, Common_Movement_WalkRight2)
	waitmovement (0)
	applymovement (LOCALID_PLAYER, Common_Movement_FaceUp)
	waitmovement (0)
	//S: Thank Lord you're here! Does your mother know?
    load_field_pic (FIELD_PIC_SAILOR2, 190, 98)
	msgbox (AldeonTown_ServantHouse_Text_OrestesScene_Servant1)
	destroy_field_pic (FIELD_PIC_SAILOR2)
	//O: No time I'm not here to see my mother, I'm here to save father.
    load_field_pic (FIELD_PIC_ORESTES, 190, 98)
	msgbox (AldeonTown_ServantHouse_Text_OrestesScene_Orestes1)
	destroy_field_pic (FIELD_PIC_ORESTES)
	//S: But you father...
    load_field_pic (FIELD_PIC_SAILOR2, 190, 98)
	msgbox (AldeonTown_ServantHouse_Text_OrestesScene_Servant2)
	destroy_field_pic (FIELD_PIC_SAILOR2)
	//O: I have a plan but I need your help. Open the passage and allow me and my friend to pass thru undisturbed
    load_field_pic (FIELD_PIC_ORESTES, 190, 98)
	msgbox (AldeonTown_ServantHouse_Text_OrestesScene_Orestes2)
	destroy_field_pic (FIELD_PIC_ORESTES)
	//S: Very strange but whatever you say
    load_field_pic (FIELD_PIC_SAILOR2, 190, 98)
	msgbox (AldeonTown_ServantHouse_Text_OrestesScene_Servant3)
	destroy_field_pic (FIELD_PIC_SAILOR2)
    closemessage
	//all to the stairs
    applymovement (LOCALID_ALDEONSERVANTHOUSE_SERVANT, Common_Movement_WalkUp3)
    applymovement (LOCALID_ALDEONSERVANTHOUSE_ORESTES, Common_Movement_WalkUp3)
    applymovement (LOCALID_PLAYER, Common_Movement_WalkUp3)
    waitmovement (0)
    //O face S
    applymovement (LOCALID_ALDEONSERVANTHOUSE_ORESTES, Common_Movement_FaceRight)
    waitmovement (0)
	//Sound
    playse (SE_EFFECTIVE)
    waitse
	//Show stairs
    call (AldeonTown_ServantHouse_Script_HideStairs)
    //S face O
    applymovement (LOCALID_ALDEONSERVANTHOUSE_SERVANT, Common_Movement_FaceLeft)
    waitmovement (0)
    //O: Now step aside
    load_field_pic (FIELD_PIC_ORESTES, 190, 98)
	msgbox (AldeonTown_ServantHouse_Text_OrestesScene_Orestes3)
	destroy_field_pic (FIELD_PIC_ORESTES)
	//S:Never seen you take this way before. Why not the front door?
    load_field_pic (FIELD_PIC_SAILOR2, 190, 98)
	msgbox (AldeonTown_ServantHouse_Text_OrestesScene_Servant4)
	destroy_field_pic (FIELD_PIC_SAILOR2)
	//O: Never you mind. Move out the way
    load_field_pic (FIELD_PIC_ORESTES, 190, 98)
	msgbox (AldeonTown_ServantHouse_Text_OrestesScene_Orestes4)
	destroy_field_pic (FIELD_PIC_ORESTES)
    closemessage
	//S out the way
    applymovement (LOCALID_ALDEONSERVANTHOUSE_SERVANT, Common_Movement_WalkRight)
    applymovement (LOCALID_ALDEONSERVANTHOUSE_ORESTES, Common_Movement_WalkRight)
    waitmovement (0)
    //O et S face
    applymovement (LOCALID_ALDEONSERVANTHOUSE_SERVANT, Common_Movement_FaceLeft)
    waitmovement (0)
	//O: And let him pass too
    load_field_pic (FIELD_PIC_ORESTES, 190, 98)
	msgbox (AldeonTown_ServantHouse_Text_OrestesScene_Orestes5)
	destroy_field_pic (FIELD_PIC_ORESTES)
    closemessage
    //S face down
    applymovement (LOCALID_ALDEONSERVANTHOUSE_SERVANT, Common_Movement_FaceDown)
    waitmovement (0)
	//O enter stairs
    applymovement (LOCALID_ALDEONSERVANTHOUSE_ORESTES, Common_Movement_WalkUp)
    waitmovement (0)
    //hide orestes
    removeobject (LOCALID_ALDEONSERVANTHOUSE_ORESTES)
    setobjectxyperm (LOCALID_ALDEONSERVANTHOUSE_ORESTES, 0, 0)
    setobjectmovementtype (LOCALID_ALDEONSERVANTHOUSE_ORESTES, MOVEMENT_TYPE_INVISIBLE)
    addobject (LOCALID_ALDEONSERVANTHOUSE_ORESTES)
	//set vars
	setvar (VAR_ORESTES_STATE, 9)
	//fin
    end
}

script AldeonTown_ServantHouse_Script_Servant {
	lock
	faceplayer
    //Before Orestes Arrives
    if (var(VAR_ORESTES_STATE) < 8) {
        specialvar (VAR_RESULT, RandDigit)
        switch (var(VAR_RESULT)) {
            case 1:
            case 2:
                msgbox (AldeonTown_ServantHouse_Text_Servant1, MSGBOX_DEFAULT)
            case 3:
            case 4:
                msgbox (AldeonTown_ServantHouse_Text_Servant2, MSGBOX_DEFAULT)
            case 5:
            case 6:
                msgbox (AldeonTown_ServantHouse_Text_Servant3, MSGBOX_DEFAULT)
            case 7:
            case 8:
                msgbox (AldeonTown_ServantHouse_Text_Servant4, MSGBOX_DEFAULT)
            default :
                msgbox (AldeonTown_ServantHouse_Text_Servant5, MSGBOX_DEFAULT)
        }
        closemessage
        applymovement (OBJ_EVENT_SERVANT, Common_Movement_FaceLeft)
        waitmovement (0)
    //During Orestreia
    } elif (var(VAR_ORESTES_STATE) > 8 && var(VAR_ORESTES_STATE) < 11) {
        msgbox (AldeonTown_ServantHouse_Text_ServantDuringOrestreia)
        closemessage
        applymovement (LOCALID_ALDEONSERVANTHOUSE_SERVANT, Common_Movement_FaceDown)
        waitmovement (0)
    //After Orestreia
    } else {
        msgbox (AldeonTown_ServantHouse_Text_ServantAfterOrestreia)
        closemessage
        applymovement (OBJ_EVENT_SERVANT, Common_Movement_FaceLeft)
        waitmovement (0)
    }
	release
	end
}

//Me servin' here house me entire life. Before maters birthin' me servin' mighty Atreus here, way back before Republic nosin' around.
text AldeonTown_ServantHouse_Text_Servant1 {
	format("Here house me entire life me servin'.")
} 

text AldeonTown_ServantHouse_Text_Servant2 {
	format("Before master's birthin' mighty Atreus here me servin' way back before Republic nosin' around.")
}

//Master Menelaus has been gone for some time and I think the rest of the family misses him.
text AldeonTown_ServantHouse_Text_Servant3 {
	format("Young master Orestes some time being gone. Family missin' him I think.")
}

//I wasn't born here but way back on my island home
text AldeonTown_ServantHouse_Text_Servant4 {
	format("Not here but way back in island home me birthin'.")
}

//Master Agamemnon is a good man and a kind master but he has seemed not well recently. Master Atreus never used to shut himself indoors like this. I hope Master Menelaus returns soon.
text AldeonTown_ServantHouse_Text_Servant5 {
	format("Good man Master Agamemnon being and kind master but recently not seemin' well. Indoors shuttin' like this Master Atreus never be doin'. Master Menelaus returnin' soon me hopin'.")
}

text AldeonTown_ServantHouse_Text_OrestesScene_Servant1 {
	format("Oh young master! It's so good to see you alive and well again! We had all begun to worry...")
}

text AldeonTown_ServantHouse_Text_OrestesScene_Orestes1 {
	format("I have no time to waste on pleasantries
            I must make haste, I'm here to save father...")
}

text AldeonTown_ServantHouse_Text_OrestesScene_Servant2 {
    format("But your father hasn't...")
}

text AldeonTown_ServantHouse_Text_OrestesScene_Orestes2 {
    format("Enough! I did not come to bandy words
            with foolish servants! Open the passage
            to the kitchen. I must be one my way!")
}

text AldeonTown_ServantHouse_Text_OrestesScene_Servant3 {
    format("Open the kitchen passage? That's a strange request, but whatever you say young master.")
}

text AldeonTown_ServantHouse_Text_OrestesScene_Orestes3 {
    format("Now step aside, servant, your work is done.")
}

text AldeonTown_ServantHouse_Text_OrestesScene_Servant4 {
    format("You're going into the servant's passage? Young masster, never in all my days...Why not just use the front door?")
}

text AldeonTown_ServantHouse_Text_OrestesScene_Orestes4 {
    format("Never you mind 'why.' Get out of my way!")
}

text AldeonTown_ServantHouse_Text_OrestesScene_Orestes5 {
    format("Do not follow, and let him pass as well.")
}

text AldeonTown_ServantHouse_Text_ServantDuringOrestreia {
    format("This is all so strange, what's gotten into the young master, and who are you?")
}

text AldeonTown_ServantHouse_Text_ServantAfterOrestreia {
    format("Thank you for helping young master and saving master Agamemnon. The house finally feels peaceful and happy again.")
}
