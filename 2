mapscripts CasaAtrei_MapScripts {

    MAP_SCRIPT_ON_TRANSITION {
        //Show Orestes before Iphigenia fight
        if (var(VAR_ORESTES_STATE) == 9) {
            call (CasaAtrei_Script_ShowOrestesBeforeIphigeniaFight)
        }
        if (var(VAR_ORESTES_STATE) == 10) {
            call (CasaAtrei_Script_ShowOrestesDuringIphigeniaFight)
        }
        //Show Orestes during Iphigenia fight
        if (var(VAR_ORESTES_STATE) == 11) {
        //Show after Klytmnestra before Agamemnon departs
        //Show after Agamemnon departs
        //Show after Iphigenia departs
        }
    }
}

script CasaAtrei_Script_ShowOrestesBeforeIphigeniaFight {
    setobjectxyperm (LOCALID_CASAATREI_ORESTES, 11, 8)
    setobjectmovementtype (LOCALID_CASAATREI_ORESTES, MOVEMENT_TYPE_LOOK_AROUND)
    setobjectxyperm (LOCALID_CASAATREI_IPHIGENIA, 11, 15)
    setobjectmovementtype (LOCALID_CASAATREI_IPHIGENIA, MOVEMENT_TYPE_FACE_DOWN)
    setobjectxyperm (LOCALID_CASAATREI_AGAMEMNON, 15, 18)
    setobjectmovementtype (LOCALID_CASAATREI_AGAMEMNON, MOVEMENT_TYPE_FACE_DOWN)
    setobjectxyperm (LOCALID_CASAATREI_KLYTMNESTRA, 13, 20)
    setobjectmovementtype (LOCALID_CASAATREI_KLYTMNESTRA, MOVEMENT_TYPE_FACE_DOWN)
    return
}

script CasaAtrei_Script_ShowOrestesDuringIphigeniaFight {
    setobjectxyperm (LOCALID_CASAATREI_ORESTES, 11, 8)
    setobjectmovementtype (LOCALID_CASAATREI_ORESTES, MOVEMENT_TYPE_RUN_IN_PLACE_DOWN)
    setobjectxyperm (LOCALID_CASAATREI_IPHIGENIA, 11, 9)
    setobjectmovementtype (LOCALID_CASAATREI_IPHIGENIA, MOVEMENT_TYPE_RUN_IN_PLACE_UP)
    setobjectxyperm (LOCALID_CASAATREI_AGAMEMNON, 15, 18)
    setobjectmovementtype (LOCALID_CASAATREI_AGAMEMNON, MOVEMENT_TYPE_FACE_DOWN)
    setobjectxyperm (LOCALID_CASAATREI_KLYTMNESTRA, 13, 20)
    setobjectmovementtype (LOCALID_CASAATREI_KLYTMNESTRA, MOVEMENT_TYPE_FACE_DOWN)
    return
}

script CasaAtrei_Script_OrestesIphigeniaTriggerA {
    lockall
    //alert
    applymovement (LOCALID_PLAYER, Common_Movement_ExclamationMark)
    waitmovement (0)
    //Into Position
    applymovement (LOCALID_PLAYER, Common_Movement_WalkUp)
    waitmovement (0)
    applymovement (LOCALID_PLAYER, Common_Movement_WalkRight)
    waitmovement (0)
    //OrestesIphigeniaFightScene
    call (CasaAtrei_Script_OrestesIphegeniaFightScene)
}

script CasaAtrei_Script_OrestesIphigeniaTriggerB {
    lockall
    //alert
    applymovement (LOCALID_PLAYER, Common_Movement_ExclamationMark)
    waitmovement (0)
    //Into Position
    applymovement (LOCALID_PLAYER, Common_Movement_FaceRight)
    waitmovement (0)
    //OrestesIphigeniaFightScene
    call (CasaAtrei_Script_OrestesIphegeniaFightScene)
}

script CasaAtrei_Script_OrestesIphigeniaTriggerC {
    lockall
    //alert
    applymovement (LOCALID_PLAYER, Common_Movement_ExclamationMark)
    waitmovement (0)
    //Into Position
    applymovement (LOCALID_PLAYER, Common_Movement_FaceDown)
    waitmovement (0)
    //OrestesIphigeniaFightScene
    call (CasaAtrei_Script_OrestesIphegeniaFightScene)
}

script CasaAtrei_Script_OrestesIphegeniaFightScene {
    //alert O
    applymovement (LOCALID_CASAATREI_ORESTES, Common_Movement_ExclamationMark)
    waitmovement (0)
    //face O to player
    specialvar (VAR_RESULT, GetPlayerFacingDirection)
    if (var(VAR_RESULT) == DIR_SOUTH) {
        applymovement (LOCALID_CASAATREI_ORESTES, Common_Movement_FaceUp)
    } else {
        applymovement (LOCALID_CASAATREI_ORESTES, Common_Movement_FaceLeft)
    }
    waitmovement (0)
    //O: the coast seems clear lets go down and save father, remember I can't help you once we confront Klytmnestra
    load_field_pic (FIELD_PIC_ORESTES, 190, 98)
	msgbox (CasaAtrei_Text_OrestesBeforeIphegeniaFight1, MSGBOX_YESNO)
    destroy_field_pic (FIELD_PIC_ORESTES)
    //I offstage: Orestes! WTF what you doing
    load_field_pic (FIELD_PIC_IPHIGENIA, 190, 98)
	msgbox (CasaAtrei_Text_IphigeniaBeforeIphegeniaFight1, MSGBOX_YESNO)
    destroy_field_pic (FIELD_PIC_IPHIGENIA)
    closemessage
    //alert both player et O
    applymovement (LOCALID_CASAATREI_ORESTES, Common_Movement_ExclamationMark)
    applymovement (LOCALID_PLAYER, Common_Movement_ExclamationMark)
    waitmovement (0)
    //face player et O
    applymovement (LOCALID_CASAATREI_ORESTES, Common_Movement_FaceDown)
    applymovement (LOCALID_PLAYER, Common_Movement_FaceDown)
    waitmovement (0)
    //enter Iphi
    applymovement (LOCALID_CASAATREI_IPHIGENIA, Common_Movement_WalkUp6)
    waitmovement (0)
    //I: You won't do this I'll stop you
    load_field_pic (FIELD_PIC_IPHIGENIA, 190, 98)
	msgbox (CasaAtrei_Text_IphigeniaBeforeIphegeniaFight2, MSGBOX_YESNO)
    destroy_field_pic (FIELD_PIC_IPHIGENIA)
    //O face to player
    if (var(VAR_RESULT) == DIR_SOUTH) {
        applymovement (LOCALID_CASAATREI_ORESTES, Common_Movement_FaceUp)
        applymovement (LOCALID_PLAYER, Common_Movement_FaceDown)
    } else {
        applymovement (LOCALID_CASAATREI_ORESTES, Common_Movement_FaceLeft)
        applymovement (LOCALID_PLAYER, Common_Movement_FaceRight)
    }
    waitmovement (0)
    //O: Go on without me, I'll hold her back. Find the master bedroom, defeat Klytmnestra and rescue Agamemnon
    load_field_pic (FIELD_PIC_ORESTES, 190, 98)
	msgbox (CasaAtrei_Text_OrestesBeforeIphegeniaFight2, MSGBOX_YESNO)
    //O face back to I
    applymovement (LOCALID_CASAATREI_ORESTES, Common_Movement_FaceDown)
    applymovement (LOCALID_PLAYER, Common_Movement_FaceDown)
    waitmovement (0)
    //O I wont let you interfere we're saving Dad
	msgbox (CasaAtrei_Text_OrestesBeforeIphegeniaFight3, MSGBOX_YESNO)
    destroy_field_pic (FIELD_PIC_ORESTES)
    //I I wont let you hurt mum
    load_field_pic (FIELD_PIC_IPHIGENIA, 190, 98)
	msgbox (CasaAtrei_Text_IphigeniaBeforeIphegeniaFight3, MSGBOX_YESNO)
    destroy_field_pic (FIELD_PIC_IPHIGENIA)
    closemessage
    //They run into each other
    setobjectmovementtype (LOCALID_CASAATREI_ORESTES, MOVEMENT_TYPE_RUN_IN_PLACE_DOWN)
    setobjectmovementtype (LOCALID_CASAATREI_IPHIGENIA, MOVEMENT_TYPE_RUN_IN_PLACE_UP)
    //setvar
    setvar (VAR_ORESTES_STATE, 10)
    //fin
    releaseall
    end
}

script CasaAtrei_Script_TriggerKlytmnestraSceneA {
	//into position
	applymovement (LOCALID_PLAYER, Common_Movement_WalkDown2)
	waitmovement (0)
	applymovement (LOCALID_PLAYER, Common_Movement_WalkRight2)
	waitmovement (0)
	//Scene
	call (CasaAtrei_Script_KlytmnestraScene)
}

script CasaAtrei_Script_TriggerKlytmnestraSceneB {
	//into position
	applymovement (LOCALID_PLAYER, Common_Movement_WalkDown2)
	waitmovement (0)
	applymovement (LOCALID_PLAYER, Common_Movement_WalkRight)
	waitmovement (0)
	//Scene
	call (CasaAtrei_Script_KlytmnestraScene)
}

script CasaAtrei_Script_TriggerKlytmnestraSceneC {
	//into position
	applymovement (LOCALID_PLAYER, Common_Movement_WalkDown2)
	waitmovement (0)
	applymovement (LOCALID_PLAYER, Common_Movement_FaceRight)
	waitmovement (0)
	//Scene
	call (CasaAtrei_Script_KlytmnestraScene)
}

script CasaAtrei_Script_KlytmnestraScene {
	//alert player
	applymovement (LOCALID_PLAYER, Common_Movement_ExclamationMark)
	waitmovement (0)
	//K: I've been waiting for you
    load_field_pic (FIELD_PIC_KLYTMNESTRA, 190, 98)
	msgbox (CasaAtrei_Text_Klytmnestra1)
	destroy_field_pic (FIELD_PIC_KLYTMNESTRA)
	closemessage
	//player walk right
	applymovement (LOCALID_PLAYER, Common_Movement_WalkRight)
	waitmovement (0)
	//K: Intro monologue
	//K battle - melting(?)
	//O off screan: you did it!
	//O come down
	//face eachother
	//O: Thanks couldn't do it without you
	//A: What happened
	//O: Father
	//go to bed
	//A: Why do I feel so cold
	//O: Father be still you were put under a spell but we rescued you
	//A: How could this be, who would have done such a thing
	//O: Your own wife, Klytmnestra
	//A: Terrible! Thanks for saving me
	//I offscreen: Orestes!
	//Enter I
	//I: How could you do this you killed mom what evil
	//O: I did nothing, I saved father and my hands are blameless in mother's tragic but deserved death
	//A: Iphi think not of losing a mother but gaining a father
	//I: I will never honor you, I'm going to my room\
	//exit I
	//A: She'll come around

script CasaAtrei_Script_Orestes {

}

script CasaAtrei_Script_Iphigenia {

}

script CasaAtrei_Script_Agamemnon {

}


text CasaAtrei_Text_OrestesBeforeIphegeniaFight1 {
    format("")
}

text CasaAtrei_Text_IphigeniaBeforeIphegeniaFight1 {
    format("")
}

text CasaAtrei_Text_IphigeniaBeforeIphegeniaFight2 {
    format("")
}

text CasaAtrei_Text_OrestesBeforeIphegeniaFight2 {
    format("")
}

text CasaAtrei_Text_OrestesBeforeIphegeniaFight3 {
    format("")
}

text CasaAtrei_Text_IphigeniaBeforeIphegeniaFight3 {
    format("")
}
